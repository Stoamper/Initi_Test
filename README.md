# Адаптивный алгоритм работы светофоров

<p align="left">
  <img width="700" src="https://logos44.ru/wp-content/uploads/2023/11/1640437874_36-funart-pro-p-foni-so-svetoforami-39.jpeg">
</p>

Адаптивный алгоритм работы светофоров необходим для оптимизации пропускной способности перекрестка в зависимости от ситуации на перекрестке.

## Содержание

- [Постановка исходной задачи](#general_task)
- [Принятые допущения](#assumptions)
- [Характеристики алгоритма работы светофоров](#algorithms)
- [Описание адаптивных алгоритмов работы светофоров](#alg_desc)
- [Рекомендации для учета в дальнейших версиях алгоритма](#recs)
- [Вклад](#contributors)

## <a name="general_task"></a> Постановка исходной задачи

Рассмотрим перекресток на рисунке. На нем находится несколько светофоров, регулирующих движение автомобилей (4 шт), и несколько - движение пешеходов по переходам (8 шт).

![Перекресток_ориг](https://github.com/Stoamper/Initi_Test/assets/87001138/c35c5c4c-4578-4e00-a1e0-669bc65a5e7b)


•	У пешеходных светофоров 2 состояния, у автомобильных - 3.

•	В каждый светофор встроена камера, которая фиксирует количество автомобилей/пешеходов в той очереди, для которых светофор установлен. Это очередь на противоположной стороне пешехода/перекрестка.

•	Автомобили при проезде перекрестка едут либо прямо, либо направо.

•	Люди и автомобили осуществляют переход или проезд перекрестка по одному, уменьшая размер соответствующей очереди на 1.

•	Каждый светофор имеет уникальный id.

•	Светофоры могут общаться при помощи событий, отсылая события друг другу по id. Пересылаемые события - это некоторые контейнеры с данными (например, там может лежать количество людей/автомобилей в очереди, id отправителя, текущее состояние светофора).

•	Светофор может взводить таймер, который через заданное время отсылают заданное событие на заданный id.

•	Отправка события - это помещение контейнера в очередь событий для светофора, у каждого светофора очередь своя собственная.

•	Светофоры обрабатывают события параллельно, независимо от друг от друга. При этом каждый светофор обрабатывает свои события последовательно, в том порядке, в каком они помещаются в очередь.

•	Светофор может получить информацию о текущем состоянии любого другого светофора синхронно (не через событие).

**Необходимо** придумать и описать адаптивный алгоритм работы светофоров для оптимизации общей пропускной способности перекрестка в зависимости от ситуации на перекрестке.


## <a name="assumptions"></a> Принятые допущения

•	В исходной задаче указано, что автомобили при проезде перекрестка едут либо прямо, либо направо. Это значит, что можно синхронизировать работу автомобильных светофоров вдоль одной дороги (улицы). Если бы автомобилям надо было поворачивать налево, то пришлось бы закладывать время выдержки для пропускания потока.

•	Работу пешеходных светофоров, расположенных друг напротив друга в рамках одного пешеходного перехода, также необходимо синхронизовать (в моменте оба должны показывать либо зеленый свет, либо красный).

•	Условно принимаем, что дорога за перекрестком свободная, отсутствуют заторы.

•	Водители и пешеходы соблюдают ПДД.


## <a name="algorithms"></a> Характеристики алгоритма работы светофоров

Пропускная способность перекрестка представляет собой количество автомобилей, которые могут пройти перекресток за определенную единицу времени. Соответственно, для решения задачи нужно рассмотреть разные варианты дорожной обстановки, которые представлены в **таблице 1**. Также заранее определим следующие переменные:

•	n_a<sub>min</sub> – минимальное количество автомобилей, проходящее по одной из дорог;

•	n_a<sub>avg</sub> – среднее количество автомобилей, проходящее по одной из дорог;

•	n_a<sub>cur</sub> – текущее количество автомобилей, проходящее по одной из дорог (зафиксировано камерой);

•	n_p<sub>min</sub> – минимальное количество пешеходов, проходящих через одну из дорог;

•	n_p<sub>avg</sub> – среднее количество пешеходов, проходящих через одну из дорог;

•	n_p<sub>cur</sub> – текущее количество пешеходов, проходящих через одну из дорог (зафиксировано камерой);

•	t_a<sub>avg</sub> – среднее время работы автомобильного светофора;

•	t_a<sub>max</sub> – максимальное время работы автомобильного светофора;

•	t_p<sub>avg</sub> – среднее время работы пешеходного светофора;

•	t_p<sub>max</sub> – максимальное время работы пешеходного светофора.


| № | Режим | Характеристики | Описание | Работа автомобильных светофоров | Работа пешеходных светофоров |
| ------- | ------- | ------- | ------- | ------- | ------- |  
| 1 | Нормальная нагрузка | Все дороги n_a<sub>cur</sub> <= n_a<sub>avg</sub>;<br> Все переходы n_p<sub>cur</sub> <= n_p<sub>avg</sub> | Данный вариант дорожной обстановки характеризуется нормальной загруженностью дороги, когда количество автомобилей/пешеходов в очереди не превышает заранее заданной величины n_a<sub>avg</sub>. Для него устанавливаются стандартные значения времени работы светофоров (t_a<sub>avg</sub> для автомобильных и t_p<sub>avg</sub> для пешеходных) | Работают по заданному стандартному таймеру t_a<sub>avg</sub> в обоих направлениях | Работают по заданному стандартному таймеру t_p<sub>avg</sub> в обоих направлениях. При этом t_p<sub>avg</sub> < t_a<sub>avg</sub>. Это сделано для того, чтобы часть времени пешеходы не создавали помехи и автомобили могли беспрепятственно повернуть направо |
| 2 | Повышенное количество пешеходов по одному / нескольким переходам | Все дороги n_a<sub>cur</sub> <= n_a<sub>avg</sub>; <br> Один / несколько переходов n_p<sub>cur</sub> > n_p<sub>avg</sub> | При увеличении количества пешеходов по одному / нескольким переходам необходимо увеличить пропускную способность конкретных мест | Работают по заданному стандартному таймеру t_a<sub>avg</sub> в обоих направлениях | В том направлении, где обнаружена необходимость увеличения пропускной способности переходов, время работы светофоров увеличивается и становится равным времени работы автомобильных светофоров (то есть до t_a<sub>avg</sub>). На тех переходах, где отсутствует необходимость в увеличении пропускной способности светофоры продолжают работать по заданному стандартному таймеру t_p<sub>avg</sub> < t_a<sub>avg</sub> чтобы не создавать помех автомобилям |  
| 3 | Повышенное количество автомобилей по одной дороге | Одна дорога n_a<sub>cur</sub> > n_a<sub>avg</sub>;<br> Все переходы n_p<sub>cur</sub> <= n_p<sub>avg</sub> | При увеличении количества автомобилей, движущихся по одной дороге, необходимо увеличить пропускную способность только в одном направлении | В том направлении, где обнаружено увеличение количества автомобилей выше среднего значения повышается время работы зеленого сигнала с t_a<sub>avg</sub> до t_a<sub>max</sub>. Соответственно, на другой дороге увеличивается время простоя автомобилей на красный сигнал | Работают по заданному стандартному таймеру t_p<sub>avg</sub> в обоих направлениях. При этом t_p<sub>avg</sub> < t_a<sub>avg</sub>. Это сделано для того, чтобы часть времени пешеходы не создавали помехи и автомобили могли беспрепятственно повернуть направо | 
| 4 | Повышенное количество автомобилей по одной дороге и пешеходов по одному / нескольким переходам | Одна дорога n_a<sub>cur</sub> > n_a<sub>avg</sub>;<br> Один переход n_p<sub>cur</sub> > n_p<sub>avg</sub> | При увеличении количества автомобилей, движущихся по одной дороге, и пешеходов необходимо увеличить пропускную способность в одном направлении для автомобилей и одном / нескольких переходах | В том направлении, где обнаружено увеличение количества автомобилей выше среднего значения повышается время работы зеленого сигнала с t_a<sub>avg</sub> до t_a<sub>max</sub>. Соответственно, на другой дороге увеличивается время простоя автомобилей на красный сигнал | В том направлении, где обнаружена необходимость увеличения пропускной способности переходов, время работы светофоров увеличивается и становится равным времени работы автомобильных светофоров (то есть t_p<sub>max</sub> = t_a<sub>avg</sub>). На тех переходах, где отсутствует необходимость в увеличении пропускной способности светофоры продолжают работать по заданному стандартному таймеру t_p<sub>avg</sub> < t_a<sub>avg</sub> чтобы не создавать помех автомобилям |  
| 5 | Час пик | Все дороги n_a<sub>cur</sub> > n_a<sub>avg</sub>;<br> Все переходы n_p<sub>cur</sub> > n_p<sub>avg</sub> | При данном варианте дорожной обстановки полностью меняется режим работы светофоров. Теперь зеленый сигнал для пешеходов горит только тогда, когда для всех автомобилей красный. Благодаря этому пешеходы не мешают поворачивающим направо автомобилям, тем самым повышается пропускная способность автомобильной дороги | В обоих направлениях у увеличивается время зеленого сигнала светофора с t_a<sub>avg</sub> до t_a<sub>max</sub>. Когда на пешеходных светофорах зеленый сигнал, то оба автомобильных показывают красный | Для работы всех пешеходных светофоров отводится отдельное время t_p<sub>max</sub> = t_a<sub>avg</sub>. При этом t_p<sub>max</sub> < t_a<sub>max</sub> чтобы не сильно задерживать автомобильный поток | 
| 6 | Ночной режим | Все дороги n_a<sub>cur</sub> -> 0;<br> Все переходы n_p<sub>cur</sub> -> 0 | Практически полное отсутствие транспортных средств и пешеходов. При таком режиме светофоры перестают работать и обмениваться событиями. Переход к ночному режиму осуществляется после установленного времени суток, а также при условии отсутствия большого транспортных средств (менее n_amin, которая закладывается программно) | Работают в режиме нерегулируемого перекрестка (желтый мигающий). Проезд согласно знакам приоритета | Отключены. Проход по пешеходному переходу согласно ПДД | 
| 7 | Аварийная ситуация | Отсутствуют | Аварийная ситуация возникает при каких-либо нештатных обстоятельствах (отключение света, поломка светофора и т.п.) | Работают в режиме нерегулируемого перекрестка (желтый мигающий). Проезд согласно знакам приоритета | Отключены. Проход по пешеходному переходу согласно ПДД |    

В целом алгоритмы работы светофоров в большей степени ориентированы на оптимизацию *автомобильного потока*, поскольку в первую очередь город должен ехать.


## <a name="alg_desc"></a> Описание адаптивных алгоритмов работы светофоров

Адаптивный режим работы предусматривает возможность корректировки режимов работы светофоров в зависимости от текущей дорожной ситуации. Для достижения наибольшей эффективности фиксация количества автомобилей/пешеходов должна выполняться постоянно.

Рассмотрим некоторые примеры, содержащие описание адаптивных алгоритмов работы светофоров. Для удобства каждому светофору присовим уникальный id. Также объединим пары светофоров, которые относятся к одной дороге и одному пешеходному переходу.

![Перекресток](https://github.com/Stoamper/Initi_Test/assets/87001138/52217c9d-b2b1-468b-b83f-bdcf17207ab2)




## <a name="recs"></a> Рекомендации для учета в дальнейших версиях алгоритма

•	Первая;

•	Вторая;


## <a name="contributors"></a> Вклад


Этот проект существует благодаря всем, кто вносит вклад:\
[Stoamper](https://gitlab.com/Stoamper)
